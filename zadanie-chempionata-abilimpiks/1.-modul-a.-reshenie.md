# 1. Модуль А. Решение

бщий алгоритм выполнения задания А на чемпионате:

1. Принять комплект с роботом, распаковать. Заполнить "Сведения о комплектности" в "Акте о приеме оборудования. Понять, чего не хватает. Заполнить "Заявку на доукомплектование" и отдать эксперту в обмен на то, чего собственно не хватает
2. Достать sd карту из робота и вставить в компьютер. Настроить подключение к сети робота
3. Вернуть sd карту в робота, включить его. Убедиться, что робот подключился к сети. Для удобства питать робота от батареек, а не блока питания.
4. Заполнить все остальные разделы "Акта о приеме"&#x20;
5. Заполнить все поля "Инструкции"
6. Продемонстрировать экспертам заполнение раздела о работоспособности в файле "Инструкция"
7. Готово.

***

## <mark style="color:purple;">А1. Прием робототехнического комплекта</mark> <a href="#x2ik5" id="x2ik5"></a>

В начале работы Конкурсант получает у организаторов упаковку с роботом и комплект расширения «Робот-курьер». Для приемки робота необходимо выполнить следующие действия:

#### _<mark style="background-color:red;">**Распаковать робота и комплект расширения и проверить комплектацию;**</mark>_

А так же **Заполнить соответствующие разделы акта о приёме оборудования. В случае неполной комплектации в текстовом редакторе заполнить запрос на доукомплектование, используя форму Запроса на доукомплектование, и продемонстрировать этот запрос техническому эксперту;**

Все, что написано в документе "Акт о приеме оборудования" (таблица #2) должно быть в комплекте поставки. Внимательно проверьте и посчитайте все, и только после этого ставьте отметку о наличии&#x20;

<figure><img src="../.gitbook/assets/image (25).png" alt=""><figcaption></figcaption></figure>

**Обратите внимание на форматирование файла: желтый цвет надо везде убрать! Шрифт, выравнивание должны быть как в остальных ячейках.**

Максимум за таблицу №2 и шапку документа+конец документа можно получить 2 балла. Оценка ставится так:

* 0% если Акт не заполнен или не заполненных ячеек больше 5 шт.
* 30% В акте не заполнены менее 5-ти ячеек. Документ оформлен не качественно (ячейки имеют желтый цвет; не подходящий тип или размер шрифта и т.д.). Заключение приемщика не написано или написано не аргументировано
* 60% В акте заполнены все ячейки. Документ оформлен не качественно (не более 5-ти ячеек) (ячейки имеют желтый цвет; не подходящий тип или размер шрифта и т.д.). Написано аргументированное заключение приёмщика
* В акте заполнены все ячейки. Правильно подобран тип и размер шрифта. Написано аргументированное заключение приёмщика

#### _<mark style="background-color:red;">**Настроить подключение робота к сети полигона;**</mark>_

Изначально робот не подключен к сети. Вам будет выдан SSID и пароль от wifi сети.

**Способ подключения через SD карту:**

<figure><img src="../.gitbook/assets/image (26).png" alt=""><figcaption></figcaption></figure>

Если на этапе загрузки Raspberry найдет файл `wpa_supplicant.conf` в **разделе** `boot` то этот файл будет перемещен в **раздел** `system`, а именно в `/etc/wpa_supplicant/wpa_supplicant.conf` и таким образом станет конфигурационным файлом подключения к Wi-Fi сетям.

Чтобы сконфигурировать Raspberry Pi в этом режиме необходимо:

* Подключите microSD карту Raspberry к вашему компьютеру с помощью карт-ридера
* Откройте **раздел** `boot` и создайте файл `wpa_supplicant.conf`:

```bash
touch wpa_supplicant.conf
```

* Откройте текстовый редактор и добавьте в этот файл следующее содержание:

```bash
ctrl_interface=DIR=/var/run/wpa_supplicant GROUP=netdev
update_config=1
country=US

network={
    ssid="WIFI_NETWORK_NAME"
    psk="wifipassword"
}
```

Использование кавычек `"` в файле с настройками обязательно!

* Сохраните файл (CTRL + S)
* Установите microSD карту в Raspberry и дождитесь завершения загрузки.

### <mark style="color:purple;">А2. Проверка базовой информации робота</mark> <a href="#p2csry" id="p2csry"></a>

### <mark style="color:purple;">А3. Проверка технических характеристик робота</mark>

Нужно заполнить весь документ "Инструкция по вводу в эксплуатацию" и все оставшиеся поля в документе "Акт о приеме"

{% hint style="info" %}
Будьте внимательны к единицам измерения - команда в терминале linux может вам выдавать, например, значение в _килобайтах_, а в таблицу надо записать в _мегабайтах_!
{% endhint %}

{% hint style="info" %}
Все команды выполнять внутри ОС робота

Чтобы зайти в робота:

`ssh pi@turtlebroXX.local` (хх = номер робота)

или&#x20;

`ssh pi@192.168.1.14` (указывайте ip своего робота)
{% endhint %}

#### _<mark style="background-color:red;">**Дозаполняем акт о приеме**</mark>_ (таблица 3 Сведения о характеристиках поступившего оборудования)

| Название дистрибутива Linux                                  | **`cat /etc/os-release`**                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| ------------------------------------------------------------ | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| Кодовое имя сборки Linux                                     | <h4><strong><code>cat /etc/os-release</code></strong></h4>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| Версия библиотеки rospy                                      | **`pip3 show rospy`**                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Размер оперативной памяти (Мбайт)                            | **`cat /proc/meminfo \| grep MemTotal`**                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| Текущая частота подключения робота к сети 5 ГГц              | **`iwconfig`**, среди вывода (в поле wlan0) будет значение Frequency, оно выводит значения в ГГц (например 5.28 ГГц), вам надо записать в МГц, (то есть \* 1000, например 5280 МГц)                                                                                                                                                                                                                                                                                                                                                                                                     |
| Разница напряжения в показаниях между топиком и мультиметром | <p>сначала смотрим что показывает топик:</p><p><strong><code>rostopic echo /bat -n 1</code></strong></p><p>затем измеряем мультиметром, разницу записываем в это поле</p>                                                                                                                                                                                                                                                                                                                                                                                                               |
| IMU датчик работает корректно                                | <p>1) установить робота на пол, рядом положить рулетку на 1 метр</p><p>2) в веб-интерфейсе робота нажать кнопку "сбросить одометрию"</p><p>3) проехать роботом 1 метр, проверить что по координате x так же стало значение 1 м</p><p>Так же можно проверять корректность данных imu по значениям, которые он публикует в топик /imu на роботе (чтобы посмотреть <code>rostopic echo /imu</code>). Он выводит значения скоростей и ускорений по 3 осям, то есть если по оси x робот не едет, то ускорение будет 0 или около 0, если двигается - то значение по модулю будет больше 0</p> |
| Кнопки D22-D25 работают                                      | см далее                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |



{% hint style="info" %}
Не забудьте в акте о приеме заполнить все остальные поля, например, наименование оборудования, дата, название организации и т.д. все поля должны быть заполнены, а желтое выделение убрано!
{% endhint %}

### <mark style="color:purple;">А4. Проверка работоспособности робота</mark>

Заполняем инструкцию по вводу в эксплуатацию

{% hint style="info" %}
Все команды выполнять внутри ОС робота

Чтобы зайти в робота:

`ssh pi@turtlebroXX.local` (хх = номер робота)

или&#x20;

`ssh pi@192.168.1.14` (указывайте ip своего робота)
{% endhint %}

#### _<mark style="background-color:red;">**Раздел "Сетевая информация"**</mark>_

<table><thead><tr><th width="419">Параметр</th><th width="413">Значение</th></tr></thead><tbody><tr><td>Присвоенное имя робота в сети:</td><td> имя вашего робота, например turtlebroXX</td></tr><tr><td>IP-адрес робота в сети роутера-полигона:</td><td><strong><code>ifconfig</code></strong> (ip будет вида 192.168.XX.ХХ)</td></tr><tr><td>Текущая частота подключения робота к сети 5 ГГц:</td><td> <strong><code>iwconfig</code></strong>, среди вывода (в поле wlan0) будет значение Frequency, оно выводит значения в ГГц (например 5.28 ГГц), вам надо записать в МГц, (то есть * 1000, например 5280 МГц)</td></tr><tr><td>Текущая частота подключения робота к сети 2.4 ГГц:</td><td> <strong><code>iwconfig</code></strong>, среди вывода (в поле wlan0) будет значение Frequency, оно выводит значения в ГГц (например 5.28 ГГц), вам надо записать в МГц, (то есть * 1000, например 5280 МГц)</td></tr></tbody></table>

#### _<mark style="background-color:red;">**Раздел "Базовая информация"**</mark>_

<table><thead><tr><th width="329">Параметр</th><th width="413">Значение</th></tr></thead><tbody><tr><td>Название дистрибутива Linux:</td><td><strong><code>cat /etc/os-release</code></strong></td></tr><tr><td>Кодовое имя сборки Linux:</td><td><strong><code>cat /etc/os-release</code></strong></td></tr><tr><td>Версия интерпретатора Python3:</td><td><strong><code>python3 -V</code></strong></td></tr><tr><td>Версия библиотеки rospy:</td><td><strong><code>pip3 show rospy</code></strong></td></tr><tr><td>Версия пакета turtlebro:</td><td><strong><code>rosversion turtlebro</code></strong></td></tr><tr><td>Версия прошивки микроконтроллера материнской платы:</td><td><strong><code>rosservice call /board_info {}</code></strong></td></tr><tr><td>Серийный номер системной платы робота (mcu_id):</td><td><strong><code>rosservice call /board_info {}</code></strong></td></tr><tr><td>Размер оперативной памяти (Мбайт):</td><td><strong><code>cat /proc/meminfo | grep MemTotal</code></strong></td></tr><tr><td>Текущий часовой пояс на роботе в формате “Time zone:Continent/City (XXX, +XXXX)”:</td><td> <strong><code>timedatectl</code></strong> (но в поле таблицы надо вписать  вручную именно как <code>Time zone:Europe/Moscow (MSK, +0300)</code>)</td></tr><tr><td>Серийный номер Raspberry Pi 4:</td><td><p> <strong><code>cat /proc/cpuinfo</code></strong> </p><p></p></td></tr><tr><td>Топики из инструкции к роботу присутствуют на роботе:</td><td> <strong><code>rostopic list</code></strong> (в таблице вписать количество топиков по инструкции, количество по факту, если кол-во разное, указать, какие топики по факту отсутсвуют\добавлены)<br>Какие топики <strong>должны быть</strong>, написано в офиц инструкии к роботу в разделе "Параметры и настройка через launch"<br><a href="https://manual.turtlebro.ru/paket-turtlebro/params">https://manual.turtlebro.ru/paket-turtlebro/params</a></td></tr></tbody></table>

_<mark style="background-color:red;">**Раздел "Технические характеристики"**</mark>_

<table><thead><tr><th width="363">Параметр</th><th width="413">Значение/Подтверждение</th></tr></thead><tbody><tr><td>Температура процессора в градусах (С):</td><td> <strong><code>vcgencmd measure_temp</code></strong></td></tr><tr><td>Текущее разрешение камеры (пикселей):</td><td><strong><code>v4l2-ctl --get-fmt-video</code></strong></td></tr><tr><td>Значение напряжения аккумуляторной сборки из топика батареи:</td><td><strong><code>rostopic echo /bat -n 1</code></strong></td></tr><tr><td>Значение напряжения аккумуляторной сборки, измеренное мультиметром:</td><td> замеряем мультиметром</td></tr><tr><td>Разница напряжения аккумуляторной сборки в показаниях между топиком /bat и мультиметром находится в допустимом диапазоне из Акта:</td><td> записываем разницу</td></tr></tbody></table>



_<mark style="background-color:red;">**Раздел "Работоспособность оборудования"**</mark>_&#x20;

_<mark style="color:red;">**Перед проверкой работоспособности для проверки пункта "IMU датчик работает корректно:" необходимо настроить адрес ROS сервера в роботе и на ноутбуке (ROS сервер будет на роботе).**</mark>_&#x20;

1\) **В ноутбуке** открываем файл .bashrc:

```bash
nano ~/.bashrc
```

&#x20;Крутим (стрелками) в низ файла, в конце добавляем строки с адресами (или редактируем ip, если такие строки уже есть):

```bash
export ROS_MASTER_URI=http://<IP-адрес робота>:11311/
export ROS_HOSTNAME=<IP-адрес компьютера>
```

Сохраняем (ctrl + o), подтверждаем (enter), выходим (ctrl + x). Перезапускаем все терминалы или выполняем команду:

```bash
source ~/.bashrc
```

2\) Теперь **такой же файл нужно отредактировать внутри робота**. Заходим в робота, выполняем

```bash
nano ~/.bashrc
```

&#x20;Крутим (стрелками) в низ файла, в конце добавляем строки с адресами (или редактируем ip, если такие строки уже есть):

```bash
export ROS_MASTER_URI=http://localhost:11311/
export ROS_HOSTNAME=<IP-адрес робота>
```

Сохраняем (ctrl + o), подтверждаем (enter), выходим (ctrl + x). Перезапускаем все терминалы "внутри робота" или выполняем команду:

```bash
source ~/.bashrc
```

***

После этого можно приступать к заполнению таблицы

<table><thead><tr><th width="350">Параметр</th><th width="413">Подтверждение</th></tr></thead><tbody><tr><td>Камера работоспособна:</td><td>проверяем на веб-интерфейсе. если изображение есть, то работоспособна</td></tr><tr><td>Одометрия корректна при линейном движении робота:</td><td>проверяем на веб-интерфейсе, что 1м робота = 1м по рулетке  </td></tr><tr><td>Одометрия корректна при угловом вращении робота:</td><td>отмечаем прямой угол на столе/на полу. выставляем робота прямо, поворачиваем на 90* - угол theta в веб-интерфейсе должен быть 90*</td></tr><tr><td>IMU датчик работает корректно:</td><td>открываем rviz (команда <code>rviz</code>, внутри ноутбука). запускаем отображение данных с imu. крутим-вертим робота - стрелочки данных imu будут вращаться </td></tr><tr><td>Лидар работает корректно:</td><td> открываем rviz. запускаем отображение данных с лидара. подставляем руку - препятствие будет видно на данных с лидара</td></tr><tr><td>Кнопки D22-D25 работают:</td><td> </td></tr><tr><td>Связь контроллера расширения с ROS работает:</td><td> </td></tr></tbody></table>

_<mark style="background-color:red;">**Проверка работоспособности периферии (пункты от "Стерео-акустическая система работает корректно:" и далее)**</mark>_

Для проверки периферийных устройств нужно загрузить прошивку в контроллер Atmega.&#x20;

_**Загрузка прошивки с подсветкой:**_

1\) Открываем "инструкцию робота turtlebro" [https://manual.turtlebro.ru/links](https://manual.turtlebro.ru/links), раздел "полезные ссылки". в нем находим ссылку на "Репозиторий файлов для задач "Профессионало&#x432;**".** В этом репозитории нужна папка "Turtlebro\_tester". В ней находится один файл - turtlebro\_tester.ino. Качаем его.

<figure><img src="../.gitbook/assets/image (22).png" alt=""><figcaption></figcaption></figure>

<figure><img src="../.gitbook/assets/image (46).png" alt=""><figcaption></figcaption></figure>

2\) Открываем Arduino IDE.&#x20;

3\) В меню с иконкой в виде стопки книг слева находим через поиск библиотеку "FastLED", устанавливаем

<figure><img src="../.gitbook/assets/image (47).png" alt=""><figcaption></figcaption></figure>

3\) Выбираем плату, загружаем скетч

<figure><img src="../.gitbook/assets/image (48).png" alt=""><figcaption></figcaption></figure>

<details>

<summary>ОШИБКА ЗАГРУЗКИ КОДА В КОНТРОЛЛЕР В Arduino IDE</summary>

Ошибка (позже приложу, как выглядит) появляется при первой попытке загрузить программу из-за отсуствия прав доступа для загрузки по USB.

Решение: в терминале ноутбука выполнить (`ttyUSB0` - вместо этого, название порта, как в вашей Arduino IDE)

`ls /dev/ttyUSB0`

(чтобы убедиться, что порт существует)

затем установить права доступа:

`sudo chmod a+rw /dev/ttyUSB0`

</details>

Далее можно заполнить поля "Светодиодная подсветка работает:" и "Кнопки D22-D25 работают:"

* По нажатию на кнопку d22 включается светодиодная лента и светодиод d29
* По нажатию на кнопки d23-d25 включаются светодиоды d26-d28
* Связь микроконтроллера с ROS работает



На этом все - заполнение файлов закончено.\


### ФИНАЛИЗАЦИЯ

<mark style="background-color:red;">**Важно!**</mark> После завершения выполнения работы нужно привести рабочее место в порядок. Это оценивается баллами. Оценка строится так, что максимум баллов ставится, если выполнены все пункты:

1. Робот выключен
2. Робот стоит на подставке
3. Документы аккуратно собраны в одном месте
4. Инструмент убран в тулбокс. Тулбокс закрыт
5. На экране ноутбука не остались открытые программы/ноутбук выключен
6. Стул задвинут к столу







**Итого для сдачи модуля А вы предоставляете:**

* Инструкция по вводу в эксплуатацию
* Акт о приеме
* Запрос на доукомплектование (100% в комплекте что-то будет отсутствовать)
