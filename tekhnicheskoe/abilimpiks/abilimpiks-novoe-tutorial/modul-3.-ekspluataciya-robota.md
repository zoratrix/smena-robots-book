# Модуль 3. Эксплуатация робота

**1. Настройка RViz**

* **Запуск RViz**:
  *   Запусти `RViz` с помощью команды:

      ```bash
      rosrun rviz rviz
      ```
* **Добавление необходимых топиков**:
  *   В `RViz` добавь следующие элементы (Нажмем Add):

      * **Map**: Для отображения карты (Add->By Topic->/map->Map).
      * **RobotModel**: Для отображения модели робота.
      * **LaserScan**: Для отображения данных LiDAR (Add->By Topic->/scan->LaserScan).
      * <mark style="color:blue;">**TF**</mark><mark style="color:blue;">: Для отслеживания трансформаций.</mark>
      * Изменить Fixed Frame на вкладке Global Option указав точку отсчета - базу робота base\_footprint&#x20;

      После того как мы вывели все необходимое в программе, нужно построить карту

2. **Построение карты полигона**

* **Запуск процесса построения карты**:
  *   Используй команду для запуска модуля построения карты:

      ```bash
      roslaunch turtlebro_navigation map_server.launch
      ```
  *   После запуска робота начни движение по полигону, чтобы создать карту. Это можно сделать с помощью команды:

      ```bash
      roslaunch turtlebro_navigation gmapping.launch
      ```
  * Или: о откроем веб-интерфейс. В открытом веб-интерфейсе нажимай WASD чтобы проехать по всему полигону и построить полную карту
  * Периодически проверяй, как отображается карта в `RViz`, чтобы убедиться, что все происходит корректно.
* **Сохранение карты**:
  *   После завершения построения карты, сохраните её на роботе, выполнив команду:

      ```bash
      rosrun map_server map_saver -f ~/my_map
      ```
  * После выполнения данной команды, будет создано два файла map.yaml и map.pgm \
    В файле map.yaml находятся параметры карты. \
    В map.pgm - собственно изображение карты

**3. Настройка точек патрулирования**

* **Открытие файла goals.toml**:
  * Перейди в директорию пакета `turtlebro_patrol` и открой файл `goals.toml`.  (полное расположение: `~home/catkin_ws/src/turtlebro_extra/turtlebro_patrol/data/goals.toml`)
  * Поставь робота в начальную позицию
  * Сбросить текущее положение (кнопка "сброс одометрии" на веб интерфейсе) или команда <mark style="background-color:red;">Х</mark>
  * Используя веб-интерфейс, найти на полигоне координаты стольких точек, сколько считаете нужным. Все координаты записать на листочек в таблицу
  * Когда все точки найдены, внести их в файл `goals.toml`
* **Сохранение изменений**:
  * Важно! Не забудь сохранить файл после редактирования.

**4. Запуск робота на полигоне**

* **Запуск программы патрулирования**:
  *   После настройки всех необходимых компонентов, запусти программу патрулирования с помощью команды:

      ```bash
      roslaunch turtlebro_patrol patrol.launch
      ```

**5. Выполнение 3 полных циклов патрулирования**

Команды для запуска, остановки, сброса патрулирования смотрите в файле:\
`~home/catkin_ws/src/turtlebro_extra/turtlebro_patrol/README`

* **Начало патрулирования**:
  * Запусти патрулирование.&#x20;
  * Команда: <mark style="background-color:red;">Х</mark>
  * Следи за роботом, чтобы убедиться, что он движется к заданным точкам.
* **Пауза в патрулировании**:
  * Дай команду на паузу <mark style="background-color:red;">Х</mark>
* **Возобновление патрулирования**:
  * После паузы дай команду на продолжение патрулирования <mark style="background-color:red;">Х</mark>
* **Остановка патрулирования**:
  *   По завершении трех циклов дай команду на остановку патрулирования и завершение работы пакета, например, с помощью <mark style="background-color:red;">команды</mark>:

      ```bash
      rosnode kill /turtlebro_patrol_node
      ```
